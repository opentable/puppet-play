#
# Upstart script for <%= name %>
#
description     "Start and Stop the <%= name %> application"
author          "Clement Escoffier <clement.escoffier@gmail.com>"
version         "1.0"

env PROJ_HOME=<%= @path %>

env PLAY_HOME=<%= @play_home %>
env PLAY_BINARY=${PLAY_HOME}/target/universal/stage/bin/<%= @projectName %>

env USER=<%= @user %>
env GROUP=<%= @group %>

start on (filesystem and net-device-up IFACE=lo) or runlevel [2345]
stop on runlevel [!2345]

respawn
respawn limit 100 60
umask 022
expect fork


pre-start script
        test -x $PLAY_HOME/activator || { stop; exit 0; }
        test -c /dev/null || { stop; exit 0; }
        chdir ${PROJ_HOME}
        rm ${PROJ_HOME}/RUNNING_PID || true
        $PLAY_HOME/activator $PROJ_HOME
end script

post-stop script
        rm ${PROJ_HOME}/RUNNING_PID || true
end script

script
cd $PROJ_HOME
exec start-stop-daemon --start --exec $PLAY_HOME/play --chuid $USER:$GROUP --chdir $PROJ_HOME -- start $PROJ_HOME  <%= @frameworkId %> <%= @javaOptions %>
end script
